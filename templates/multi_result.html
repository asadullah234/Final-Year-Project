<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Traffic Signal Analyzer - Results</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.1.3/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            padding-top: 20px;
            padding-bottom: 40px;
            background-color: #f8f9fa;
        }
        .card {
            margin-bottom: 20px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .card-header {
            background-color: #3a86ff;
            color: white;
            font-weight: bold;
        }
        .result-card {
            border-radius: 10px;
            overflow: hidden;
        }
        .comparison-section {
            background-color: #e9ecef;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .congestion-low {
            color: #38b000;
            font-weight: bold;
        }
        .congestion-medium {
            color: #f48c06;
            font-weight: bold;
        }
        .congestion-high {
            color: #d00000;
            font-weight: bold;
        }
        .efficiency-positive {
            color: #38b000;
            font-weight: bold;
        }
        .signal-time {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        .signal-circle {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .green { background-color: #38b000; }
        .yellow { background-color: #ffba08; }
        .red { background-color: #d00000; }
        .summary-heading {
            background-color: #3a86ff;
            color: white;
            padding: 10px 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .summary-card {
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        .chart-container {
            margin: 30px 0;
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .image-container {
            position: relative;
            margin-bottom: 15px;
        }
        .image-label {
            position: absolute;
            top: 10px;
            left: 10px;
            background-color: rgba(0,0,0,0.7);
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
        }
        .vehicle-count-badge {
            font-size: 1.2rem;
            padding: 8px 12px;
            margin-bottom: 10px;
            display: inline-block;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="text-center mb-4">AI Traffic Signal Analysis Results</h1>
        
        <!-- Summary Statistics Section -->
        <div class="summary-card">
            <h2 class="summary-heading">Traffic Efficiency Summary</h2>
            <div class="row">
                <div class="col-md-3">
                    <div class="card h-100">
                        <div class="card-body text-center">
                            <h5>Total Vehicles</h5>
                            <h2>{{ traffic_efficiency.total_vehicles }}</h2>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card h-100">
                        <div class="card-body text-center">
                            <h5>Avg. Vehicles per Junction</h5>
                            <h2>{{ traffic_efficiency.avg_vehicles_per_junction }}</h2>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card h-100">
                        <div class="card-body text-center">
                            <h5>Avg. Green Time</h5>
                            <h2>{{ traffic_efficiency.avg_green_time }}s</h2>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card h-100">
                        <div class="card-body text-center">
                            <h5>Avg. Congestion</h5>
                            <h2>{{ traffic_efficiency.avg_congestion }}%</h2>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="row mt-4">
                <div class="col-12">
                    <h4>Total Vehicle Composition</h4>
                    <div class="d-flex flex-wrap">
                        {% for vehicle_type, count in traffic_efficiency.total_vehicle_types.items() %}
                        <div class="me-3 mb-2">
                            <span class="badge bg-primary px-3 py-2">{{ vehicle_type }}: {{ count }}</span>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Signal Comparison Chart -->
        <div class="chart-container">
            <h3 class="mb-3">Traffic Analysis by Junction</h3>
            <img src="data:image/png;base64,{{ line_chart }}" class="img-fluid" alt="Junction Comparison Chart">
            <div class="text-center mt-3">
                <div class="alert alert-info">
                    <strong>Average Congestion: {{ traffic_efficiency.avg_congestion }}%</strong>
                    <p class="mb-0">AI traffic signals optimize timing based on actual traffic conditions, resulting in improved vehicle throughput and reduced wait times.</p>
                </div>
            </div>
        </div>
        
        <!-- Individual Junction Results -->
        <h2 class="mb-4">Junction Analysis Results</h2>
        
        {% if not has_vehicles %}
        <div class="alert alert-warning">
            <h4 class="alert-heading">No vehicles detected!</h4>
            <p>No vehicles were detected in the uploaded images. Please try uploading different images.</p>
        </div>
        {% endif %}
        
        <div class="row">
            {% for result in results %}
            <div class="col-lg-6 mb-4">
                <div class="card result-card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <span>Junction {{ loop.index }}</span>
                        <span class="badge bg-primary">{{ result.total_vehicles }} vehicles detected</span>
                    </div>
                    <div class="card-body">
                        <!-- Before-After Images -->
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <div class="image-container">
                                    <img src="/static/{{ result.original_image }}" class="img-fluid rounded" alt="Original Image">
                                    <div class="image-label">Before</div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="image-container">
                                    <img src="/static/{{ result.processed_image }}" class="img-fluid rounded" alt="Processed Image">
                                    <div class="image-label">After</div>
                                </div>
                            </div>
                        </div>

                        <!-- Vehicle Counts -->
                        <div class="mb-4">
                            <h5>Detected Vehicles:</h5>
                            <div class="d-flex flex-wrap">
                                {% for vehicle_type, count in result.vehicle_counts.items() %}
                                <span class="badge bg-secondary me-2 mb-2">{{ vehicle_type }}: {{ count }}</span>
                                {% endfor %}
                            </div>
                            <img src="data:image/png;base64,{{ result.chart_img }}" class="img-fluid mt-2" alt="Vehicle Count Chart">
                        </div>

                        <!-- Congestion Level -->
                        <div class="mb-4">
                            <h5>Congestion Analysis:</h5>
                            {% if result.total_vehicles <= 10 %}
                            <div class="alert alert-success">
                                <h5 class="congestion-low">Low Congestion ({{ result.timings.congestion_percentage }}%)</h5>
                                <p>Traffic flow is smooth with minimal delays.</p>
                            </div>
                            {% elif result.total_vehicles <= 30 %}
                            <div class="alert alert-warning">
                                <h5 class="congestion-medium">Medium Congestion ({{ result.timings.congestion_percentage }}%)</h5>
                                <p>Moderate traffic density with potential for short delays.</p>
                            </div>
                            {% else %}
                            <div class="alert alert-danger">
                                <h5 class="congestion-high">High Congestion ({{ result.timings.congestion_percentage }}%)</h5>
                                <p>Heavy traffic conditions with significant delays likely.</p>
                            </div>
                            {% endif %}
                        </div>

                        <!-- Signal Timing -->
                        <div class="card mb-4">
                            <div class="card-header">AI Optimized Signal Timing</div>
                            <div class="card-body">
                                <div class="signal-time">
                                    <div class="signal-circle green"></div>
                                    <span>Green: {{ result.timings.green_time }}s</span>
                                </div>
                                <div class="signal-time">
                                    <div class="signal-circle yellow"></div>
                                    <span>Yellow: {{ result.timings.yellow_time }}s</span>
                                </div>
                                <div class="signal-time">
                                    <div class="signal-circle red"></div>
                                    <span>Red: {{ result.timings.red_time }}s</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        
        <!-- Back to Home Button -->
        <div class="text-center mb-5">
            <a href="/" class="btn btn-primary btn-lg">Analyze New Images</a>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.1.3/js/bootstrap.bundle.min.js"></script>
</body>
</html>